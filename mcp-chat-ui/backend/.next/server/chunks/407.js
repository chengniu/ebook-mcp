exports.id=407,exports.ids=[407],exports.modules={2201:(a,b,c)=>{"use strict";c.d(b,{C8:()=>k,wF:()=>j});var d=c(9021),e=c(3873),f=c.n(e),g=c(6688);class h{constructor(a="./data/sessions",b=1e3,c=864e5){this.storageDir=a,this.storageFile=f().join(a,"sessions.json"),this.maxSessions=b,this.cleanupIntervalMs=c,this.storage={sessions:{},metadata:{lastCleanup:new Date().toISOString(),totalSessions:0}}}async initialize(){try{await this.ensureStorageDirectory(),await this.loadSessions(),this.startCleanupTimer()}catch(a){throw console.error("Failed to initialize SessionManager:",a),new g.PO("Failed to initialize session storage")}}async createSession(a,b,c=[],d){let e=this.generateSessionId(),f=new Date,g={id:e,title:"New Chat",messages:d?[d]:[],createdAt:f,updatedAt:f,provider:a,model:b,mcpServers:c};return this.storage.sessions[e]=g,this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,await this.saveSessions(),g}async getSession(a){let b=this.storage.sessions[a];if(!b)throw new g.m_(`Session with ID ${a} not found`);return{...b}}async updateSession(a,b){let c=this.storage.sessions[a];if(!c)throw new g.m_(`Session with ID ${a} not found`);let{id:d,createdAt:e,...f}=b,h={...c,...f,updatedAt:new Date};return this.storage.sessions[a]=h,await this.saveSessions(),{...h}}async addMessage(a,b){let c=this.storage.sessions[a];if(!c)throw new g.m_(`Session with ID ${a} not found`);return c.messages.push(b),c.updatedAt=new Date,this.storage.sessions[a]=c,await this.saveSessions(),{...c}}async deleteSession(a){if(!this.storage.sessions[a])throw new g.m_(`Session with ID ${a} not found`);delete this.storage.sessions[a],this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,await this.saveSessions()}async searchSessions(a={}){let{query:b,provider:c,limit:d=50,offset:e=0,sortBy:f="updatedAt",sortOrder:g="desc"}=a,h=Object.values(this.storage.sessions);if(b){let a=b.toLowerCase();h=h.filter(b=>b.title.toLowerCase().includes(a)||b.messages.some(b=>b.content.toLowerCase().includes(a)))}c&&(h=h.filter(a=>a.provider===c)),h.sort((a,b)=>{let c=a[f],d=b[f],e=0;return e=c instanceof Date&&d instanceof Date?c.getTime()-d.getTime():String(c).localeCompare(String(d)),"desc"===g?-e:e});let i=h.length;return{sessions:h.slice(e,e+d).map(a=>({id:a.id,title:a.title,createdAt:a.createdAt.toISOString(),updatedAt:a.updatedAt.toISOString(),messageCount:a.messages.length,provider:a.provider,model:a.model})),total:i,hasMore:e+d<i}}async generateSessionTitle(a,b){let c=this.storage.sessions[a];if(!c)throw new g.m_(`Session with ID ${a} not found`);if(!b||0===c.messages.length)return this.generateFallbackTitle(c);try{let d=c.messages.filter(a=>"user"===a.role||"assistant"===a.role).slice(0,4).map(a=>`${a.role}: ${a.content.substring(0,200)}`).join("\n"),e=`Based on this conversation, generate a concise, descriptive title (max 50 characters):

${d}

Title:`,f=await b.generateCompletion({messages:[{role:"user",content:e}],maxTokens:20,temperature:.3}),g=f.content?.trim().replace(/^["']|["']$/g,"").substring(0,50)||this.generateFallbackTitle(c);return await this.updateSession(a,{title:g}),g}catch(a){return console.error("Failed to generate session title:",a),this.generateFallbackTitle(c)}}async cleanupSessions(){let a=Object.values(this.storage.sessions),b=new Date,c=0;for(let d of a.filter(a=>b.getTime()-a.updatedAt.getTime()>2592e6))delete this.storage.sessions[d.id],c++;let d=Object.values(this.storage.sessions);if(d.length>this.maxSessions)for(let a of d.sort((a,b)=>a.updatedAt.getTime()-b.updatedAt.getTime()).slice(0,d.length-this.maxSessions))delete this.storage.sessions[a.id],c++;return this.storage.metadata.lastCleanup=b.toISOString(),this.storage.metadata.totalSessions=Object.keys(this.storage.sessions).length,c>0&&await this.saveSessions(),{deletedCount:c}}getStatistics(){let a=Object.values(this.storage.sessions),b={openai:0,deepseek:0,openrouter:0},c=0;return a.forEach(a=>{b[a.provider]++,c+=a.messages.length}),{totalSessions:a.length,lastCleanup:this.storage.metadata.lastCleanup,providerBreakdown:b,averageMessagesPerSession:a.length>0?c/a.length:0}}async shutdown(){this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=void 0),await this.saveSessions()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}generateFallbackTitle(a){let b=a.messages.filter(a=>"user"===a.role);if(b.length>0){let a=b[0].content,c=a.substring(0,40);return a.length>40?`${c}...`:c}let c=a.createdAt.toLocaleDateString();return`Chat from ${c}`}async ensureStorageDirectory(){try{await d.promises.mkdir(this.storageDir,{recursive:!0})}catch(a){throw new g.PO(`Failed to create storage directory: ${a}`)}}async loadSessions(){try{let a=await d.promises.readFile(this.storageFile,"utf-8"),b=JSON.parse(a);Object.values(b.sessions).forEach(a=>{a.createdAt=new Date(a.createdAt),a.updatedAt=new Date(a.updatedAt),a.messages.forEach(a=>{a.timestamp=new Date(a.timestamp)})}),this.storage=b}catch(a){if("ENOENT"===a.code)this.storage={sessions:{},metadata:{lastCleanup:new Date().toISOString(),totalSessions:0}},await this.saveSessions();else throw console.error("Failed to load sessions:",a),new g.PO("Failed to load session data")}}async saveSessions(){try{let a=JSON.stringify(this.storage,null,2);await d.promises.writeFile(this.storageFile,a,"utf-8")}catch(a){throw console.error("Failed to save sessions:",a),new g.PO("Failed to save session data")}}startCleanupTimer(){this.cleanupTimer=setInterval(async()=>{try{await this.cleanupSessions()}catch(a){console.error("Automatic cleanup failed:",a)}},this.cleanupIntervalMs)}}let i=null;function j(){return i||(i=new h),i}async function k(){let a=j();return await a.initialize(),a}},5108:(a,b,c)=>{"use strict";c.d(b,{N5:()=>g,tr:()=>f});var d=c(6688);class e{static{this.DEFAULT_MAX_RETRIES=3}static{this.DEFAULT_RETRY_DELAY=1e3}static{this.DEFAULT_TIMEOUT=3e4}constructor(a){this.config={maxRetries:e.DEFAULT_MAX_RETRIES,retryDelay:e.DEFAULT_RETRY_DELAY,timeout:e.DEFAULT_TIMEOUT,...a},this.validateConfig()}async generateCompletion(a){return this.executeWithRetry(async()=>{switch(this.config.provider){case"openai":return await this.callOpenAI(a);case"deepseek":return await this.callDeepSeek(a);case"openrouter":return await this.callOpenRouter(a);default:throw new d.yI(`Unsupported LLM provider: ${this.config.provider}`)}})}async testConnection(){try{return{success:!!(await this.generateCompletion({messages:[{role:"user",content:"Hello"}],maxTokens:5,temperature:0})).content}}catch(a){return console.error("Connection test failed:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}getProviderCapabilities(){switch(this.config.provider){case"openai":return{supportsToolCalling:!0,supportsStreaming:!0,maxTokens:128e3,supportedModels:["gpt-4","gpt-4-turbo","gpt-3.5-turbo"]};case"deepseek":return{supportsToolCalling:!0,supportsStreaming:!0,maxTokens:32e3,supportedModels:["deepseek-chat","deepseek-coder"]};case"openrouter":return{supportsToolCalling:!0,supportsStreaming:!0,maxTokens:2e5,supportedModels:["anthropic/claude-3-opus","openai/gpt-4","meta-llama/llama-2-70b-chat"]};default:throw new d.yI(`Unsupported LLM provider: ${this.config.provider}`)}}validateApiKey(a){if(!a||"string"!=typeof a)return!1;switch(this.config.provider){case"openai":case"deepseek":return a.startsWith("sk-")&&a.length>20;case"openrouter":return a.startsWith("sk-or-")&&a.length>30;default:return a.length>10}}async executeWithRetry(a){let b=Error("Unknown error"),c=this.config.maxRetries||e.DEFAULT_MAX_RETRIES;for(let f=0;f<=c;f++)try{return await this.withTimeout(a(),this.config.timeout||e.DEFAULT_TIMEOUT)}catch(g){if(b=g,g instanceof d.yI||!this.isRetryableError(g))throw g;if(f===c)break;let a=(this.config.retryDelay||e.DEFAULT_RETRY_DELAY)*Math.pow(2,f);await this.sleep(a),console.warn(`LLM request attempt ${f+1} failed, retrying in ${a}ms:`,g)}throw new d.PO(`LLM request failed after ${c+1} attempts: ${b.message}`)}isRetryableError(a){return void 0!==a.retryable?a.retryable:!!(a.message.includes("fetch")||a.message.includes("network"))||(a.statusCode?[408,429,500,502,503,504].includes(a.statusCode):!!a.message.toLowerCase().includes("rate limit"))}withTimeout(a,b){return Promise.race([a,new Promise((a,c)=>{setTimeout(()=>c(Error(`Request timeout after ${b}ms`)),b)})])}sleep(a){return new Promise(b=>setTimeout(b,a))}validateConfig(){if(!this.config.apiKey)throw new d.yI("API key is required");if(!this.config.model)throw new d.yI("Model is required");if(!["openai","deepseek","openrouter"].includes(this.config.provider))throw new d.yI("Invalid LLM provider");if(!this.validateApiKey(this.config.apiKey))throw new d.yI(`Invalid API key format for ${this.config.provider}`);if(void 0!==this.config.maxRetries&&this.config.maxRetries<0)throw new d.yI("Max retries must be non-negative");if(void 0!==this.config.retryDelay&&this.config.retryDelay<0)throw new d.yI("Retry delay must be non-negative");if(void 0!==this.config.timeout&&this.config.timeout<=0)throw new d.yI("Timeout must be positive")}async callOpenAI(a){let b=this.config.baseUrl||"https://api.openai.com/v1",c=`${b}/chat/completions`,d={model:a.model||this.config.model,messages:a.messages,max_tokens:a.maxTokens||1e3,temperature:a.temperature??.7};a.tools&&a.tools.length>0&&(d.tools=a.tools,a.toolChoice&&(d.tool_choice=a.toolChoice));let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,"User-Agent":"MCP-Chat-UI/1.0"},body:JSON.stringify(d)});if(!e.ok){let a,b=await e.text();try{a=JSON.parse(b)}catch{a={error:{message:b}}}let c=Error(`OpenAI API error: ${a.error?.message||b}`);throw c.statusCode=e.status,c.code=a.error?.code,c.retryable=[408,429,500,502,503,504].includes(e.status),c}let f=await e.json(),g=f.choices[0];if(!g)throw Error("No response choices returned from OpenAI API");return{content:g.message?.content||"",toolCalls:g.message?.tool_calls?.map(a=>({id:a.id,type:a.type,function:{name:a.function.name,arguments:a.function.arguments}})),usage:f.usage?{promptTokens:f.usage.prompt_tokens,completionTokens:f.usage.completion_tokens,totalTokens:f.usage.total_tokens}:void 0,finishReason:g.finish_reason}}async callDeepSeek(a){let b=this.config.baseUrl||"https://api.deepseek.com/v1",c=`${b}/chat/completions`,d={model:a.model||this.config.model,messages:a.messages,max_tokens:a.maxTokens||1e3,temperature:a.temperature??.7};a.tools&&a.tools.length>0&&(d.tools=a.tools,a.toolChoice&&(d.tool_choice=a.toolChoice));let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,"User-Agent":"MCP-Chat-UI/1.0"},body:JSON.stringify(d)});if(!e.ok){let a,b=await e.text();try{a=JSON.parse(b)}catch{a={error:{message:b}}}let c=Error(`DeepSeek API error: ${a.error?.message||b}`);throw c.statusCode=e.status,c.code=a.error?.code,c.retryable=[408,429,500,502,503,504].includes(e.status),c}let f=await e.json(),g=f.choices[0];if(!g)throw Error("No response choices returned from DeepSeek API");return{content:g.message?.content||"",toolCalls:g.message?.tool_calls?.map(a=>({id:a.id,type:a.type,function:{name:a.function.name,arguments:a.function.arguments}})),usage:f.usage?{promptTokens:f.usage.prompt_tokens,completionTokens:f.usage.completion_tokens,totalTokens:f.usage.total_tokens}:void 0,finishReason:g.finish_reason}}async callOpenRouter(a){let b=this.config.baseUrl||"https://openrouter.ai/api/v1",c=`${b}/chat/completions`,d={model:a.model||this.config.model,messages:a.messages,max_tokens:a.maxTokens||1e3,temperature:a.temperature??.7};a.tools&&a.tools.length>0&&(d.tools=a.tools,a.toolChoice&&(d.tool_choice=a.toolChoice));let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.config.apiKey}`,"HTTP-Referer":"http://localhost:3000","X-Title":"MCP Chat UI","User-Agent":"MCP-Chat-UI/1.0"},body:JSON.stringify(d)});if(!e.ok){let a,b=await e.text();try{a=JSON.parse(b)}catch{a={error:{message:b}}}let c=Error(`OpenRouter API error: ${a.error?.message||b}`);throw c.statusCode=e.status,c.code=a.error?.code,c.retryable=[408,429,500,502,503,504].includes(e.status),c}let f=await e.json(),g=f.choices[0];if(!g)throw Error("No response choices returned from OpenRouter API");return{content:g.message?.content||"",toolCalls:g.message?.tool_calls?.map(a=>({id:a.id,type:a.type,function:{name:a.function.name,arguments:a.function.arguments}})),usage:f.usage?{promptTokens:f.usage.prompt_tokens,completionTokens:f.usage.completion_tokens,totalTokens:f.usage.total_tokens}:void 0,finishReason:g.finish_reason}}}function f(a){return new e(a)}function g(a){switch(a){case"openai":return{baseUrl:"https://api.openai.com/v1",model:"gpt-4",maxRetries:3,retryDelay:1e3,timeout:3e4};case"deepseek":return{baseUrl:"https://api.deepseek.com/v1",model:"deepseek-chat",maxRetries:3,retryDelay:1e3,timeout:3e4};case"openrouter":return{baseUrl:"https://openrouter.ai/api/v1",model:"openai/gpt-4",maxRetries:3,retryDelay:1e3,timeout:45e3};default:throw new d.yI(`Unsupported provider: ${a}`)}}},6487:()=>{},6688:(a,b,c)=>{"use strict";c.d(b,{PO:()=>h,_P:()=>i,m_:()=>g,yI:()=>f});var d=c(2190);class e extends Error{constructor(a,b=500,c=!0){super(a),this.statusCode=b,this.isOperational=c,Error.captureStackTrace(this,this.constructor)}}class f extends e{constructor(a){super(a,400)}}class g extends e{constructor(a="Resource not found"){super(a,404)}}class h extends e{constructor(a="Internal server error"){super(a,500)}}function i(a){return async(b,c)=>{try{return await a(b,c)}catch(a){return(console.error("API Error:",a),a instanceof e)?d.NextResponse.json({error:a.constructor.name,message:a.message,statusCode:a.statusCode},{status:a.statusCode}):a instanceof Error?d.NextResponse.json({error:"InternalServerError",message:a.message,statusCode:500},{status:500}):d.NextResponse.json({error:"UnknownError",message:"An unknown error occurred",statusCode:500},{status:500})}}}},7746:(a,b,c)=>{"use strict";c.d(b,{gx:()=>f});var d=c(2190);let e=["http://localhost:5173","http://localhost:3000","http://localhost:4173"];function f(a){return async(b,c)=>{var f;let g={"Access-Control-Allow-Origin":(f=b.headers.get("origin")||void 0)&&e.includes(f)?f:e[0],"Access-Control-Allow-Methods":"GET, POST, PUT, DELETE, OPTIONS","Access-Control-Allow-Headers":"Content-Type, Authorization, X-Requested-With","Access-Control-Allow-Credentials":"true","Access-Control-Max-Age":"86400"};if("OPTIONS"===b.method)return new d.NextResponse(null,{status:200,headers:g});try{let d=await a(b,c);return Object.entries(g).forEach(([a,b])=>{d.headers.set(a,b)}),d}catch(a){return console.error("CORS Handler Error:",a),new d.NextResponse("Internal Server Error",{status:500,headers:g})}}}},8335:()=>{}};